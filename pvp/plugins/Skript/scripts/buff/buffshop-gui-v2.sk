# ============================================
# BUFF SHOP GUI v2.0 - –°–∏—Å—Ç–µ–º–∞ —Å–ª–æ—Ç—ñ–≤
# ============================================

# ===== –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á =====

function bsCreateBorder(inv: inventory):
	set {_borders::*} to 0, 1, 2, 3, 4, 5, 6, 7, 8, 36, 37, 38, 39, 41, 42, 43, 44, 9, 17, 18, 26, 27 and 35
	loop {_borders::*}:
		set slot loop-value of {_inv} to black stained glass pane named " "

function bsPlayClick(p: player):
	play sound "ui.button.click" to {_p}

function bsPlayError(p: player):
	play sound "entity.villager.no" to {_p}

function bsPlaySuccess(p: player):
	play sound "entity.player.levelup" to {_p}

# ===== –ì–û–õ–û–í–ù–ï –ú–ï–ù–Æ –ú–ê–ì–ê–ó–ò–ù–£ =====

function openBuffShopMain(p: player):
	open virtual chest inventory with 5 rows named "&cüõí –ú–∞–≥–∞–∑–∏–Ω –ë–∞—Ñ—Ñ–æ–≤" to {_p}
	wait 1 tick
	
	bsCreateBorder({_p}'s current inventory)
	
	# Speed –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
	set {_speed} to head from value {buff::category::speed::icon}
	set name of {_speed} to {buff::category::speed::name}
	set line 1 of lore of {_speed} to "&8‚ùñ &7–ë–∞—Ñ—Ñ—ã –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç—å"
	set line 2 of lore of {_speed} to "&8‚§∑ &7–ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è"
	set line 3 of lore of {_speed} to " "
	set line 4 of lore of {_speed} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"
	set slot 20 of {_p}'s current inventory to {_speed}
	
	# Defense –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
	set {_defense} to head from value {buff::category::defense::icon}
	set name of {_defense} to {buff::category::defense::name}
	set line 1 of lore of {_defense} to "&8‚ùñ &7–ë–∞—Ñ—Ñ—ã –Ω–∞ –∑–∞—â–∏—Ç—É"
	set line 2 of lore of {_defense} to "&8‚§∑ &7–∏ –≤—ã–∂–∏–≤–∞–Ω–∏–µ"
	set line 3 of lore of {_defense} to " "
	set line 4 of lore of {_defense} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"
	set slot 22 of {_p}'s current inventory to {_defense}
	
	# Kill –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
	set {_kill} to head from value {buff::category::kill::icon}
	set name of {_kill} to {buff::category::kill::name}
	set line 1 of lore of {_kill} to "&8‚ùñ &7–ë–æ–Ω—É—Å—ã –∑–∞ —É–±–∏–π—Å—Ç–≤–∞"
	set line 2 of lore of {_kill} to "&8‚§∑ &7–ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–æ–≤"
	set line 3 of lore of {_kill} to " "
	set line 4 of lore of {_kill} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"
	set slot 24 of {_p}'s current inventory to {_kill}
	
	# –ë–∞–ª–∞–Ω—Å
	set {_balance} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMzRjY2I1Mjc1MGU5N2U4MzBhZWJmYThhMjFkNWRhMGQzNjRkMGZkYWQ5ZmIwY2MyMjBmZTJjYTg0MTE4NDJjMyJ9fX0="
	set {_money} to getPlayerBalance({_p})
	set name of {_balance} to "&cüí∞ –ë–∞–ª–∞–Ω—Å"
	set line 1 of lore of {_balance} to "&8‚ùñ &7–í–∞—à –±–∞–ª–∞–Ω—Å:"
	set line 2 of lore of {_balance} to "&8‚§∑ &f%{_money}% &7–º–æ–Ω–µ—Ç"
	set slot 4 of {_p}'s current inventory to {_balance}
	
	# –ù–∞–∑–∞–¥
	set {_back} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTBlMGE0ZDQ4Y2Q4MjlhNmQ1ODY4OTA5ZDY0M2ZhNGFmZmQzOWU4YWU2Y2FhZjZlYzc5NjA5Y2Y3NjQ5YjFjIn19fQ=="
	set name of {_back} to "&c‚Æú –ó–∞–∫—Ä—ã—Ç—å"
	set lore of {_back} to "&8‚ùñ &7–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é"
	set slot 40 of {_p}'s current inventory to {_back}

# ===== –ú–ï–ù–Æ –ö–ê–¢–ï–ì–û–†–Ü–á (–ü–û–ö–£–ü–ö–ê) =====

function openBuffCategory(p: player, category: text):
	set {_title} to {buff::category::%{_category}%::name}
	open virtual chest inventory with 5 rows named {_title} to {_p}
	wait 1 tick
	
	bsCreateBorder({_p}'s current inventory)
	
	# –í—ñ–¥–æ–±—Ä–∞–∑–∏—Ç–∏ –±–∞—Ñ–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
	set {_slots::*} to 20, 22 and 24
	set {_index} to 1
	
	loop {buff::list::%{_category}%::*}:
		set {_buffId} to loop-value
		if {_buffId} is set:
			set {_slot} to {_slots::%{_index}%}
			set {_item} to createBuffShopItem({_p}, {_buffId})
			set slot {_slot} of {_p}'s current inventory to {_item}
			add 1 to {_index}
	
	# –ë–∞–ª–∞–Ω—Å
	set {_balance} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvMzRjY2I1Mjc1MGU5N2U4MzBhZWJmYThhMjFkNWRhMGQzNjRkMGZkYWQ5ZmIwY2MyMjBmZTJjYTg0MTE4NDJjMyJ9fX0="
	set {_money} to getPlayerBalance({_p})
	set name of {_balance} to "&cüí∞ –ë–∞–ª–∞–Ω—Å"
	set line 1 of lore of {_balance} to "&8‚ùñ &7–í–∞—à –±–∞–ª–∞–Ω—Å:"
	set line 2 of lore of {_balance} to "&8‚§∑ &f%{_money}% &7–º–æ–Ω–µ—Ç"
	set slot 4 of {_p}'s current inventory to {_balance}
	
	# –ù–∞–∑–∞–¥
	set {_back} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTBlMGE0ZDQ4Y2Q4MjlhNmQ1ODY4OTA5ZDY0M2ZhNGFmZmQzOWU4YWU2Y2FhZjZlYzc5NjA5Y2Y3NjQ5YjFjIn19fQ=="
	set name of {_back} to "&c‚Æú –ù–∞–∑–∞–¥"
	set line 1 of lore of {_back} to "&8‚ùñ &7–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º"
	set slot 40 of {_p}'s current inventory to {_back}

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ –±–∞—Ñ–∞ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω—É
function createBuffShopItem(p: player, buffId: text) :: item:
	set {_name} to {buff::%{_buffId}%::name}
	set {_price} to {buff::%{_buffId}%::price}
	set {_desc1} to {buff::%{_buffId}%::desc1}
	set {_desc2} to {buff::%{_buffId}%::desc2}
	set {_desc3} to {buff::%{_buffId}%::desc3}
	set {_desc4} to {buff::%{_buffId}%::desc4}
	set {_texture} to {buff::%{_buffId}%::texture}
	
	set {_balance} to getPlayerBalance({_p})
	set {_unlocked} to isBuffUnlocked({_p}, {_buffId})
	
	set {_item} to head from value {_texture}
	
	if {_unlocked} is true:
		set name of {_item} to "&c‚úî %{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to {_desc4}
		set line 6 of lore of {_item} to " "
		set line 7 of lore of {_item} to "&c‚úî –ö—É–ø–ª–µ–Ω–æ"
	else if {_balance} >= {_price}:
		set name of {_item} to "&f%{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to {_desc4}
		set line 6 of lore of {_item} to " "
		set line 7 of lore of {_item} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å"
	else:
		set name of {_item} to "&7%{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to {_desc4}
		set line 6 of lore of {_item} to " "
		set line 7 of lore of {_item} to "&7‚úñ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç"
	
	return {_item}

# ===== –ú–ï–ù–Æ "–ú–û–ò –ë–ê–§–§–´" =====

function openMyBuffsMenu(p: player):
	open virtual chest inventory with 5 rows named "&cüíº –ú–æ–∏ –ë–∞—Ñ—Ñ—ã" to {_p}
	wait 1 tick
	
	# –†–∞–º–∫–∞
	loop 45 times:
		set {_sl} to loop-number - 1
		if {_sl} is not in {10, 11, 12, 19, 20, 21, 28, 29, 30, 13, 22, 31, 4, 40}:
			set slot {_sl} of {_p}'s current inventory to black stained glass pane named " "
	
	# SPEED SECTION
	set {_speedTitle} to head from value {buff::category::speed::icon}
	set name of {_speedTitle} to "&cüèÉ –ë–ê–§–§–´ –°–ö–û–†–û–°–¢–ò"
	set line 1 of lore of {_speedTitle} to "&8‚ùñ &7–í–∞—à–∏ –±–∞—Ñ—Ñ—ã —Å–∫–æ—Ä–æ—Å—Ç–∏"
	set slot 10 of {_p}'s current inventory to {_speedTitle}
	
	set {_hasSpeed} to false
	set {_speedSlot} to 11
	loop {buff::list::speed::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			set {_hasSpeed} to true
			set {_item} to createOwnedBuffItem({_p}, loop-value)
			set slot {_speedSlot} of {_p}'s current inventory to {_item}
			add 1 to {_speedSlot}
	
	if {_hasSpeed} is false:
		set {_none} to gray dye
		set name of {_none} to "&7–ù–µ—Ç –±–∞—Ñ—Ñ–æ–≤"
		set line 1 of lore of {_none} to "&8‚ùñ &7–£ –≤–∞—Å –Ω–µ—Ç –±–∞—Ñ—Ñ–æ–≤ —Å–∫–æ—Ä–æ—Å—Ç–∏"
		set line 2 of lore of {_none} to "&8‚§∑ &f/buffshop &7—á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å"
		set slot 11 of {_p}'s current inventory to {_none}
	
	# DEFENSE SECTION
	set {_defTitle} to head from value {buff::category::defense::icon}
	set name of {_defTitle} to "&cüõ° –ë–ê–§–§–´ –ó–ê–©–ò–¢–´"
	set line 1 of lore of {_defTitle} to "&8‚ùñ &7–í–∞—à–∏ –±–∞—Ñ—Ñ—ã –∑–∞—â–∏—Ç—ã"
	set slot 19 of {_p}'s current inventory to {_defTitle}
	
	set {_hasDef} to false
	set {_defSlot} to 20
	loop {buff::list::defense::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			set {_hasDef} to true
			set {_item} to createOwnedBuffItem({_p}, loop-value)
			set slot {_defSlot} of {_p}'s current inventory to {_item}
			add 1 to {_defSlot}
	
	if {_hasDef} is false:
		set {_none} to gray dye
		set name of {_none} to "&7–ù–µ—Ç –±–∞—Ñ—Ñ–æ–≤"
		set line 1 of lore of {_none} to "&8‚ùñ &7–£ –≤–∞—Å –Ω–µ—Ç –±–∞—Ñ—Ñ–æ–≤ –∑–∞—â–∏—Ç—ã"
		set line 2 of lore of {_none} to "&8‚§∑ &f/buffshop &7—á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å"
		set slot 20 of {_p}'s current inventory to {_none}
	
	# KILL SECTION
	set {_killTitle} to head from value {buff::category::kill::icon}
	set name of {_killTitle} to "&cüíÄ –ë–û–ù–£–°–´ –ó–ê –£–ë–ò–ô–°–¢–í–ê"
	set line 1 of lore of {_killTitle} to "&8‚ùñ &7–í–∞—à–∏ –±–æ–Ω—É—Å—ã –∑–∞ —É–±–∏–π—Å—Ç–≤–∞"
	set slot 28 of {_p}'s current inventory to {_killTitle}
	
	set {_hasKill} to false
	set {_killSlot} to 29
	loop {buff::list::kill::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			set {_hasKill} to true
			set {_item} to createOwnedBuffItem({_p}, loop-value)
			set slot {_killSlot} of {_p}'s current inventory to {_item}
			add 1 to {_killSlot}
	
	if {_hasKill} is false:
		set {_none} to gray dye
		set name of {_none} to "&7–ù–µ—Ç –±–∞—Ñ—Ñ–æ–≤"
		set line 1 of lore of {_none} to "&8‚ùñ &7–£ –≤–∞—Å –Ω–µ—Ç –±–æ–Ω—É—Å–æ–≤ –∑–∞ —É–±–∏–π—Å—Ç–≤–∞"
		set line 2 of lore of {_none} to "&8‚§∑ &f/buffshop &7—á—Ç–æ–±—ã –∫—É–ø–∏—Ç—å"
		set slot 29 of {_p}'s current inventory to {_none}
	
	# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
	set {_owned} to 0
	loop {buff::all::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			add 1 to {_owned}
	
	set {_stats} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTNhNjljM2NhYTMxMzA0ZTk5NTIzMjhjNzJjZWUwYjU3YjJhMmJkNDZjZTljNWNiODhjMDdkMTI2NjI3N2Q2YSJ9fX0="
	set name of {_stats} to "&c‚Ñπ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞"
	set line 1 of lore of {_stats} to "&8‚ùñ &7–ö—É–ø–ª–µ–Ω–æ –±–∞—Ñ—Ñ–æ–≤:"
	set line 2 of lore of {_stats} to "&8‚§∑ &f%{_owned}%&8/&78"
	set slot 4 of {_p}'s current inventory to {_stats}
	
	# –ö–Ω–æ–ø–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó
	set {_activate} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvM2VkZDIwYmU5MzUyMDk0OWU2Y2U3ODlkYzRmNDNlZmFlYjI4YzcxN2VlNmJmY2JiZTAyNzgwMTQyZjcxNiJ9fX0="
	set name of {_activate} to "&c‚ö° –ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ë–ê–§–§–´"
	set line 1 of lore of {_activate} to "&8‚ùñ &7–í—ã–±—Ä–∞—Ç—å –∫–∞–∫–∏–µ –±–∞—Ñ—Ñ—ã"
	set line 2 of lore of {_activate} to "&8‚§∑ &7–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –±–æ—é"
	set line 3 of lore of {_activate} to " "
	set line 4 of lore of {_activate} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å"
	set slot 40 of {_p}'s current inventory to {_activate}

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ –≤–ª–∞—Å–Ω–æ–≥–æ –±–∞—Ñ–∞
function createOwnedBuffItem(p: player, buffId: text) :: item:
	set {_name} to {buff::%{_buffId}%::name}
	set {_desc1} to {buff::%{_buffId}%::desc1}
	set {_desc2} to {buff::%{_buffId}%::desc2}
	set {_desc3} to {buff::%{_buffId}%::desc3}
	set {_tier} to {buff::%{_buffId}%::tier}
	set {_texture} to {buff::%{_buffId}%::texture}
	set {_category} to {buff::%{_buffId}%::category}
	
	set {_item} to head from value {_texture}
	
	set {_isActive} to isBuffActive({_p}, {_buffId})
	
	if {_isActive} is true:
		set name of {_item} to "&c‚úî %{_name}% &7(–ê–ö–¢–ò–í–ï–ù)"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to "&c‚úî –ê–∫—Ç–∏–≤–µ–Ω –≤ –±–æ—é"
		set line 6 of lore of {_item} to "&8Tier %{_tier}%"
	else:
		set name of {_item} to "&7%{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to "&7–ù–µ –∞–∫—Ç–∏–≤–µ–Ω"
		set line 6 of lore of {_item} to "&8Tier %{_tier}%"
	
	return {_item}

# ===== –ú–ï–ù–Æ –í–ò–ë–û–†–£ –ê–ö–¢–ò–í–ù–ò–• –ë–ê–§–Ü–í =====

function openSelectBuffMenu(p: player):
	set {_maxSlots} to getMaxBuffSlots({_p})
	set {_usedSlots} to getActiveBuffSlotsCount({_p})
	
	open virtual chest inventory with 5 rows named "&c‚ö° –ê–∫—Ç–∏–≤–Ω—ã–µ –ë–∞—Ñ—Ñ—ã" to {_p}
	wait 1 tick
	
	bsCreateBorder({_p}'s current inventory)
	
	# –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–ª–æ—Ç–∏
	set {_slotsInfo} to nether star
	set name of {_slotsInfo} to "&c‚ö° –°–ª–æ—Ç—ã –±–∞—Ñ—Ñ–æ–≤"
	set line 1 of lore of {_slotsInfo} to "&8‚ùñ &7–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Å–ª–æ—Ç–æ–≤:"
	set line 2 of lore of {_slotsInfo} to "&8‚§∑ &f%{_usedSlots}%&8/&f%{_maxSlots}%"
	set line 3 of lore of {_slotsInfo} to " "
	
	if {_maxSlots} is 1:
		set line 4 of lore of {_slotsInfo} to "&8‚ñ∏ &7–¢–∞—Ä–∏—Ñ: &f–ë–µ–∑ –¥–æ–Ω–∞—Ç–∞"
	else if {_maxSlots} is 2:
		set line 4 of lore of {_slotsInfo} to "&8‚ñ∏ &7–¢–∞—Ä–∏—Ñ: &f–ë—É–Ω—Ç"
	else if {_maxSlots} is 3:
		set line 4 of lore of {_slotsInfo} to "&8‚ñ∏ &7–¢–∞—Ä–∏—Ñ: &f–ì–Ω–µ–≤"
	
	set slot 4 of {_p}'s current inventory to {_slotsInfo}
	
	# SPEED —Å–ª–æ—Ç
	set {_speedItem} to createBuffSlotItem({_p}, "speed")
	set slot 20 of {_p}'s current inventory to {_speedItem}
	
	# DEFENSE —Å–ª–æ—Ç
	set {_defItem} to createBuffSlotItem({_p}, "defense")
	set slot 22 of {_p}'s current inventory to {_defItem}
	
	# KILL —Å–ª–æ—Ç
	set {_killItem} to createBuffSlotItem({_p}, "kill")
	set slot 24 of {_p}'s current inventory to {_killItem}
	
	# –ù–∞–∑–∞–¥
	set {_back} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTBlMGE0ZDQ4Y2Q4MjlhNmQ1ODY4OTA5ZDY0M2ZhNGFmZmQzOWU4YWU2Y2FhZjZlYzc5NjA5Y2Y3NjQ5YjFjIn19fQ=="
	set name of {_back} to "&c‚Æú –ó–∞–∫—Ä—ã—Ç—å"
	set lore of {_back} to "&8‚ùñ &7–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é"
	set slot 40 of {_p}'s current inventory to {_back}

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ —Å–ª–æ—Ç–∞
function createBuffSlotItem(p: player, category: text) :: item:
	set {_activeBuff} to {buff.active.slot.%{_p}%.%{_category}%}
	set {_unlockedBuffs::*} to getUnlockedBuffsInCategory({_p}, {_category})
	
	if {_activeBuff} is set:
		# –Ñ –∞–∫—Ç–∏–≤–Ω–∏–π –±–∞—Ñ
		set {_texture} to {buff::%{_activeBuff}%::texture}
		set {_item} to head from value {_texture}
		
		set {_name} to {buff::%{_activeBuff}%::name}
		set {_desc1} to {buff::%{_activeBuff}%::desc1}
		set {_desc2} to {buff::%{_activeBuff}%::desc2}
		set {_desc3} to {buff::%{_activeBuff}%::desc3}
		
		set name of {_item} to "&c‚úî %{buff::category::%{_category}%::name}%"
		set line 1 of lore of {_item} to "&8‚ùñ &7–ê–∫—Ç–∏–≤–µ–Ω: %{_name}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc1}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 4 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 5 of lore of {_item} to " "
		
		if size of {_unlockedBuffs::*} > 1:
			set line 6 of lore of {_item} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å"
		else:
			set line 6 of lore of {_item} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã —Å–Ω—è—Ç—å"
	else:
		# –ù–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–∞—Ñ–∞
		set {_icon} to {buff::category::%{_category}%::icon}
		set {_item} to head from value {_icon}
		
		# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ —î –ª—ñ–º—ñ—Ç —Å–ª–æ—Ç—ñ–≤
		set {_maxSlots} to getMaxBuffSlots({_p})
		set {_usedSlots} to getActiveBuffSlotsCount({_p})
		set {_limitReached} to false
		
		if {_usedSlots} >= {_maxSlots}:
			set {_limitReached} to true
		
		if {_limitReached} is true:
			# –õ—ñ–º—ñ—Ç –¥–æ—Å—è–≥–Ω—É—Ç–æ - –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π —Å–ª–æ—Ç
			set name of {_item} to "&8üîí %{buff::category::%{_category}%::name}%"
			set line 1 of lore of {_item} to "&8‚ùñ &7–õ–∏–º–∏—Ç —Å–ª–æ—Ç–æ–≤ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç"
			set line 2 of lore of {_item} to "&8‚§∑ &7–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: &f%{_usedSlots}%&8/&f%{_maxSlots}%"
			set line 3 of lore of {_item} to " "
			
			if {_maxSlots} is 1:
				set line 4 of lore of {_item} to "&8‚§∑ &f–ë—É–Ω—Ç &7–¥–ª—è 2 —Å–ª–æ—Ç–æ–≤"
			else if {_maxSlots} is 2:
				set line 4 of lore of {_item} to "&8‚§∑ &f–ì–Ω–µ–≤ &7–¥–ª—è 3 —Å–ª–æ—Ç–æ–≤"
		else if size of {_unlockedBuffs::*} > 0:
			# –Ñ –±–∞—Ñ–∏ —ñ —î –≤—ñ–ª—å–Ω—ñ —Å–ª–æ—Ç–∏
			set name of {_item} to "&7%{buff::category::%{_category}%::name}%"
			set line 1 of lore of {_item} to "&8‚ùñ &7–°–ª–æ—Ç –Ω–µ –∑–∞–Ω—è—Ç"
			set line 2 of lore of {_item} to " "
			set line 3 of lore of {_item} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å"
		else:
			# –ù–µ–º–∞—î –±–∞—Ñ—ñ–≤
			set name of {_item} to "&7%{buff::category::%{_category}%::name}%"
			set line 1 of lore of {_item} to "&8‚ùñ &7–ù–µ—Ç –∫—É–ø–ª–µ–Ω–Ω—ã—Ö –±–∞—Ñ—Ñ–æ–≤"
			set line 2 of lore of {_item} to " "
			set line 3 of lore of {_item} to "&8‚ñ∂ &f/buffshop &7–¥–ª—è –ø–æ–∫—É–ø–∫–∏"
	
	return {_item}

# ===== –ú–ï–ù–Æ –í–ò–ë–û–†–£ –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –ë–ê–§–ê =====

function openBuffSelectionMenu(p: player, category: text):
	set {_title} to "&c‚ö° –í—ã–±–æ—Ä: %{buff::category::%{_category}%::name}%"
	open virtual chest inventory with 3 rows named {_title} to {_p}
	wait 1 tick
	
	# –†–∞–º–∫–∞
	loop 27 times:
		set {_sl} to loop-number - 1
		if {_sl} is not in {10, 11, 12, 13, 14, 15, 16, 22}:
			set slot {_sl} of {_p}'s current inventory to black stained glass pane named " "
	
	# –ü–æ–∫–∞–∑–∞—Ç–∏ –≤—Å—ñ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω—ñ –±–∞—Ñ–∏
	set {_unlockedBuffs::*} to getUnlockedBuffsInCategory({_p}, {_category})
	set {_slot} to 10
	
	loop {_unlockedBuffs::*}:
		set {_item} to createSelectableBuffItem({_p}, loop-value)
		set slot {_slot} of {_p}'s current inventory to {_item}
		add 1 to {_slot}
	
	# –ö–Ω–æ–ø–∫–∞ "–°–Ω—è—Ç—å"
	if {buff.active.slot.%{_p}%.%{_category}%} is set:
		set {_remove} to red dye
		set name of {_remove} to "&c‚úñ –°–Ω—è—Ç—å –±–∞—Ñ"
		set line 1 of lore of {_remove} to "&8‚ùñ &7–£–±—Ä–∞—Ç—å –±–∞—Ñ –∏–∑ —Å–ª–æ—Ç–∞"
		set line 2 of lore of {_remove} to " "
		set line 3 of lore of {_remove} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã —Å–Ω—è—Ç—å"
		set slot 16 of {_p}'s current inventory to {_remove}
	
	# –ù–∞–∑–∞–¥
	set {_back} to head from value "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvOTBlMGE0ZDQ4Y2Q4MjlhNmQ1ODY4OTA5ZDY0M2ZhNGFmZmQzOWU4YWU2Y2FhZjZlYzc5NjA5Y2Y3NjQ5YjFjIn19fQ=="
	set name of {_back} to "&c‚Æú –ù–∞–∑–∞–¥"
	set line 1 of lore of {_back} to "&8‚ùñ &7–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ª–æ—Ç–∞–º"
	set slot 22 of {_p}'s current inventory to {_back}

# –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–µ–¥–º–µ—Ç–∞ –¥–ª—è –≤–∏–±–æ—Ä—É
function createSelectableBuffItem(p: player, buffId: text) :: item:
	set {_name} to {buff::%{_buffId}%::name}
	set {_desc1} to {buff::%{_buffId}%::desc1}
	set {_desc2} to {buff::%{_buffId}%::desc2}
	set {_desc3} to {buff::%{_buffId}%::desc3}
	set {_tier} to {buff::%{_buffId}%::tier}
	set {_texture} to {buff::%{_buffId}%::texture}
	
	set {_item} to head from value {_texture}
	
	set {_isActive} to isBuffActive({_p}, {_buffId})
	
	if {_isActive} is true:
		set name of {_item} to "&c‚úî %{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to "&c‚úî –°–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–µ–Ω"
		set line 6 of lore of {_item} to "&8Tier %{_tier}%"
	else:
		set name of {_item} to "&f%{_name}%"
		set line 1 of lore of {_item} to "&8‚ùñ %{_desc1}%"
		set line 2 of lore of {_item} to "&8‚§∑ %{_desc2}%"
		set line 3 of lore of {_item} to "&8‚§∑ %{_desc3}%"
		set line 4 of lore of {_item} to " "
		set line 5 of lore of {_item} to "&8‚ñ∂ &f–ù–∞–∂–º–∏ —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å"
		set line 6 of lore of {_item} to "&8Tier %{_tier}%"
	
	return {_item}

# ===== –õ–û–ì–Ü–ö–ê –ü–û–ö–£–ü–ö–ò =====

function purchaseBuff(p: player, buffId: text):
	if isBuffUnlocked({_p}, {_buffId}) is true:
		send "&c‚úñ –≠—Ç–æ—Ç –±–∞—Ñ—Ñ —É–∂–µ –∫—É–ø–ª–µ–Ω!" to {_p}
		bsPlayError({_p})
		stop
	
	set {_price} to getBuffPrice({_buffId})
	set {_balance} to getPlayerBalance({_p})
	
	if {_balance} < {_price}:
		send "&c‚úñ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç! –ù—É–∂–Ω–æ: &f%{_price}%&c, —É –≤–∞—Å: &f%{_balance}%" to {_p}
		bsPlayError({_p})
		stop
	
	set {_result} to withdrawBalance({_p}, {_price})
	
	if {_result} is false:
		send "&c‚úñ –û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!" to {_p}
		bsPlayError({_p})
		stop
	
	unlockBuff({_p}, {_buffId})
	
	set {_name} to getBuffName({_buffId})
	send " " to {_p}
	send "&c&l‚úî –£–°–ü–ï–®–ù–û!" to {_p}
	send "&8‚ùñ &7–í—ã –∫—É–ø–∏–ª–∏ –±–∞—Ñ—Ñ: %{_name}%" to {_p}
	send "&8‚§∑ &7–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ &f/mybuffs &7—á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å" to {_p}
	send " " to {_p}
	bsPlaySuccess({_p})
	
	wait 10 ticks
	close {_p}'s inventory
	wait 2 ticks
	openMyBuffsMenu({_p})
