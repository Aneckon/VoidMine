# ============================================
# –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –°–ò–°–¢–ï–ú–ò –ë–ê–§–Ü–í v2.0
# ============================================

# ===== –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –°–õ–û–¢–Ü–í =====
on load:
	# –ö—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –≥—Ä—É–ø –≥—Ä–∞–≤—Ü—ñ–≤
	set {buff::slots::default} to 1  # –ë–µ–∑ –¥–æ–Ω–∞—Ç—É
	set {buff::slots::bunt} to 2      # Bunt –¥–æ–Ω–∞—Ç
	set {buff::slots::gnev} to 3  # Gnev –¥–æ–Ω–∞—Ç
	
	# ===== –ö–ê–¢–ï–ì–û–†–Ü–á –ë–ê–§–Ü–í =====
	set {buff::categories::*} to "speed", "defense" and "kill"
	
	# –ù–∞–∑–≤–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
	set {buff::category::speed::name} to "&cüèÉ –ë–∞—Ñ—Ñ—ã –°–∫–æ—Ä–æ—Å—Ç–∏"
	set {buff::category::speed::icon} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjJhYzk5MjZkY2ZiNzY0MWExNjIxMjY5MTEyNmUwM2Q5NWQ2NDZhZDM0NWI3NWExOTIwNjFhMWE5MzlkODkwMiJ9fX0="
	
	set {buff::category::defense::name} to "&cüõ° –ë–∞—Ñ—Ñ—ã –ó–∞—â–∏—Ç—ã"
	set {buff::category::defense::icon} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZjFmOTA5Y2MxYzMyZGEzYjExNjAzOTQ0ZDRmNzMxZDYzYmFhOWFkZTFlMTIxMWRkZjlmMDE1NTA5MWM1Yzk0YiJ9fX0="
	
	set {buff::category::kill::name} to "&cüíÄ –ë–æ–Ω—É—Å—ã –∑–∞ –£–±–∏–π—Å—Ç–≤–∞"
	set {buff::category::kill::icon} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZGEwMGM1M2NmNTdjYWNjN2Y1ZThlM2ZlODRiMmY1ZGIxMjJjZDc2ZmNlZDc4MGE5NTNiOTk2MzlmYjMxOTg4MiJ9fX0="
	
	# ===== SPEED BUFFS =====
	set {buff::speed1::id} to "speed1"
	set {buff::speed1::name} to "&f–°–∫–æ—Ä–æ—Å—Ç—å I"
	set {buff::speed1::tier} to 1
	set {buff::speed1::price} to 500
	set {buff::speed1::category} to "speed"
	set {buff::speed1::desc1} to "&7–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å"
	set {buff::speed1::desc2} to "&7–ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è –Ω–∞ –∞—Ä–µ–Ω–µ"
	set {buff::speed1::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fSpeed I"
	set {buff::speed1::desc4} to "&8Tier 1 &8| &f1500 –º–æ–Ω–µ—Ç"
	set {buff::speed1::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjJhYzk5MjZkY2ZiNzY0MWExNjIxMjY5MTEyNmUwM2Q5NWQ2NDZhZDM0NWI3NWExOTIwNjFhMWE5MzlkODkwMiJ9fX0="
	
	set {buff::speed2::id} to "speed2"
	set {buff::speed2::name} to "&f–°–∫–æ—Ä–æ—Å—Ç—å II"
	set {buff::speed2::tier} to 2
	set {buff::speed2::price} to 2000
	set {buff::speed2::category} to "speed"
	set {buff::speed2::desc1} to "&7–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç"
	set {buff::speed2::desc2} to "&7—Å–∫–æ—Ä–æ—Å—Ç—å –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è"
	set {buff::speed2::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fSpeed II"
	set {buff::speed2::desc4} to "&8Tier 2 &8| &f2500 –º–æ–Ω–µ—Ç"
	set {buff::speed2::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjJhYzk5MjZkY2ZiNzY0MWExNjIxMjY5MTEyNmUwM2Q5NWQ2NDZhZDM0NWI3NWExOTIwNjFhMWE5MzlkODkwMiJ9fX0="
	
	set {buff::adrenaline::id} to "adrenaline"
	set {buff::adrenaline::name} to "&f–ê–¥—Ä–µ–Ω–∞–ª–∏–Ω"
	set {buff::adrenaline::tier} to 3
	set {buff::adrenaline::price} to 5000
	set {buff::adrenaline::category} to "speed"
	set {buff::adrenaline::desc1} to "&7–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å"
	set {buff::adrenaline::desc2} to "&7–ø–æ—Å–ª–µ —É–±–∏–π—Å—Ç–≤–∞ (10 —Å–µ–∫)"
	set {buff::adrenaline::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fSpeed III"
	set {buff::adrenaline::desc4} to "&8Tier 3 &8| &f6000 –º–æ–Ω–µ—Ç"
	set {buff::adrenaline::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvNjJhYzk5MjZkY2ZiNzY0MWExNjIxMjY5MTEyNmUwM2Q5NWQ2NDZhZDM0NWI3NWExOTIwNjFhMWE5MzlkODkwMiJ9fX0="
	
	# ===== DEFENSE BUFFS =====
	set {buff::kb_resist::id} to "kb_resist"
	set {buff::kb_resist::name} to "&f–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ"
	set {buff::kb_resist::tier} to 1
	set {buff::kb_resist::price} to 700
	set {buff::kb_resist::category} to "defense"
	set {buff::kb_resist::desc1} to "&7–£–º–µ–Ω—å—à–∞–µ—Ç –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ"
	set {buff::kb_resist::desc2} to "&7–æ—Ç —É–¥–∞—Ä–æ–≤"
	set {buff::kb_resist::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fResistance I"
	set {buff::kb_resist::desc4} to "&8Tier 1 &8| &f1700 –º–æ–Ω–µ—Ç"
	set {buff::kb_resist::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZjFmOTA5Y2MxYzMyZGEzYjExNjAzOTQ0ZDRmNzMxZDYzYmFhOWFkZTFlMTIxMWRkZjlmMDE1NTA5MWM1Yzk0YiJ9fX0="
	
	set {buff::bonus_hp::id} to "bonus_hp"
	set {buff::bonus_hp::name} to "&f–ë–æ–Ω—É—Å –•–ü"
	set {buff::bonus_hp::tier} to 2
	set {buff::bonus_hp::price} to 1500
	set {buff::bonus_hp::category} to "defense"
	set {buff::bonus_hp::desc1} to "&7–î–æ–±–∞–≤–ª—è–µ—Ç +2 —Å–µ—Ä–¥—Ü–∞"
	set {buff::bonus_hp::desc2} to "&7–≤ –Ω–∞—á–∞–ª–µ –±–æ—è"
	set {buff::bonus_hp::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &f+4 HP"
	set {buff::bonus_hp::desc4} to "&8Tier 2 &8| &f2500 –º–æ–Ω–µ—Ç"
	set {buff::bonus_hp::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZjFmOTA5Y2MxYzMyZGEzYjExNjAzOTQ0ZDRmNzMxZDYzYmFhOWFkZTFlMTIxMWRkZjlmMDE1NTA5MWM1Yzk0YiJ9fX0="
	
	set {buff::iron_skin::id} to "iron_skin"
	set {buff::iron_skin::name} to "&f–ñ–µ–ª–µ–∑–Ω–∞—è –∫–æ–∂–∞"
	set {buff::iron_skin::tier} to 3
	set {buff::iron_skin::price} to 6000
	set {buff::iron_skin::category} to "defense"
	set {buff::iron_skin::desc1} to "&7–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞"
	set {buff::iron_skin::desc2} to "&7–æ—Ç –≤—Å–µ—Ö –∞—Ç–∞–∫"
	set {buff::iron_skin::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fResistance II"
	set {buff::iron_skin::desc4} to "&8Tier 3 &8| &f7000 –º–æ–Ω–µ—Ç"
	set {buff::iron_skin::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZjFmOTA5Y2MxYzMyZGEzYjExNjAzOTQ0ZDRmNzMxZDYzYmFhOWFkZTFlMTIxMWRkZjlmMDE1NTA5MWM1Yzk0YiJ9fX0="
	
	# ===== KILL BONUSES =====
	set {buff::focus::id} to "focus"
	set {buff::focus::name} to "&f–§–æ–∫—É—Å"
	set {buff::focus::tier} to 2
	set {buff::focus::price} to 2500
	set {buff::focus::category} to "kill"
	set {buff::focus::desc1} to "&7–†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ"
	set {buff::focus::desc2} to "&7–∫–∞–∂–¥–æ–≥–æ —É–±–∏–π—Å—Ç–≤–∞"
	set {buff::focus::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fRegeneration II (5s)"
	set {buff::focus::desc4} to "&8Tier 2 &8| &f5500 –º–æ–Ω–µ—Ç"
	set {buff::focus::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZGEwMGM1M2NmNTdjYWNjN2Y1ZThlM2ZlODRiMmY1ZGIxMjJjZDc2ZmNlZDc4MGE5NTNiOTk2MzlmYjMxOTg4MiJ9fX0="
	
	set {buff::second_wind::id} to "second_wind"
	set {buff::second_wind::name} to "&f–í—Ç–æ—Ä–æ–µ –¥—ã—Ö–∞–Ω–∏–µ"
	set {buff::second_wind::tier} to 3
	set {buff::second_wind::price} to 7000
	set {buff::second_wind::category} to "kill"
	set {buff::second_wind::desc1} to "&7–ü–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ"
	set {buff::second_wind::desc2} to "&7–ø–æ—Å–ª–µ —É–±–∏–π—Å—Ç–≤–∞"
	set {buff::second_wind::desc3} to "&8–≠—Ñ—Ñ–µ–∫—Ç: &fFull Heal + Regen V (3s)"
	set {buff::second_wind::desc4} to "&8Tier 3 &8| &f9000 –º–æ–Ω–µ—Ç"
	set {buff::second_wind::texture} to "eyJ0ZXh0dXJlcyI6eyJTS0lOIjp7InVybCI6Imh0dHA6Ly90ZXh0dXJlcy5taW5lY3JhZnQubmV0L3RleHR1cmUvZGEwMGM1M2NmNTdjYWNjN2Y1ZThlM2ZlODRiMmY1ZGIxMjJjZDc2ZmNlZDc4MGE5NTNiOTk2MzlmYjMxOTg4MiJ9fX0="
	
	# ===== –°–ü–ò–°–ö–ò –ë–ê–§–Ü–í –ü–û –ö–ê–¢–ï–ì–û–†–Ü–Ø–ú =====
	set {buff::list::speed::*} to "speed1", "speed2" and "adrenaline"
	set {buff::list::defense::*} to "kb_resist", "bonus_hp" and "iron_skin"
	set {buff::list::kill::*} to "focus" and "second_wind"
	
	# –í—Å—ñ –±–∞—Ñ–∏ –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
	set {buff::all::*} to "speed1", "speed2", "adrenaline", "kb_resist", "bonus_hp", "iron_skin", "focus" and "second_wind"
	
	send "&c[BuffShop] &a–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è v2.0 –∑–∞–≥—Ä—É–∂–µ–Ω–∞!" to console
	send "&c[BuffShop] &7–°–ª–æ—Ç—ã: &fDefault=%{buff::slots::default}% &8| &f–ë—É–Ω—Ç=%{buff::slots::bunt}% &8| &f–ì–Ω–µ–≤=%{buff::slots::gnev}%" to console

# ===== –û–°–ù–û–í–ù–Ü –§–£–ù–ö–¶–Ü–á =====

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–∏–π –±–∞—Ñ
function isBuffUnlocked(p: player, buffId: text) :: boolean:
	if {buff.unlocked.%{_p}%.%{_buffId}%} is true:
		return true
	return false

# –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è –±–∞—Ñ–∞
function unlockBuff(p: player, buffId: text):
	set {buff.unlocked.%{_p}%.%{_buffId}%} to true

# –û—Ç—Ä–∏–º–∞—Ç–∏ —Ü—ñ–Ω—É –±–∞—Ñ–∞
function getBuffPrice(buffId: text) :: number:
	return {buff::%{_buffId}%::price}

# –û—Ç—Ä–∏–º–∞—Ç–∏ –Ω–∞–∑–≤—É –±–∞—Ñ–∞
function getBuffName(buffId: text) :: text:
	return {buff::%{_buffId}%::name}

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –±–∞—Ñ–∞
function getBuffCategory(buffId: text) :: text:
	return {buff::%{_buffId}%::category}

# –û—Ç—Ä–∏–º–∞—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Å–ª–æ—Ç—ñ–≤ –¥–ª—è –≥—Ä–∞–≤—Ü—è
function getMaxBuffSlots(p: player) :: number:
	if {_p} has permission "buffshop.gnev":
		return {buff::slots::gnev}
	else if {_p} has permission "buffshop.bunt":
		return {buff::slots::bunt}
	else:
		return {buff::slots::default}

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∏—Ö —Å–ª–æ—Ç—ñ–≤
function getActiveBuffSlotsCount(p: player) :: number:
	set {_count} to 0
	loop {buff::categories::*}:
		if {buff.active.slot.%{_p}%.%loop-value%} is set:
			add 1 to {_count}
	return {_count}

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –≥—Ä–∞–≤–µ—Ü—å –º–∞—î —Ö–æ—á–∞ –± –æ–¥–∏–Ω –±–∞—Ñ
function hasAnyBuff(p: player) :: boolean:
	loop {buff::all::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			return true
	return false

# –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω—ñ –±–∞—Ñ–∏ –≥—Ä–∞–≤—Ü—è –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
function getUnlockedBuffsInCategory(p: player, category: text) :: objects:
	clear {_result::*}
	loop {buff::list::%{_category}%::*}:
		if isBuffUnlocked({_p}, loop-value) is true:
			add loop-value to {_result::*}
	return {_result::*}

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –±–∞—Ñ –∞–∫—Ç–∏–≤–Ω–∏–π
function isBuffActive(p: player, buffId: text) :: boolean:
	set {_category} to getBuffCategory({_buffId})
	if {buff.active.slot.%{_p}%.%{_category}%} is {_buffId}:
		return true
	return false

# –ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –±–∞—Ñ
function activateBuff(p: player, buffId: text) :: boolean:
	set {_category} to getBuffCategory({_buffId})
	
	# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ä–æ–∑–±–ª–æ–∫–æ–≤–∞–Ω–∏–π
	if isBuffUnlocked({_p}, {_buffId}) is false:
		return false
	
	# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª—ñ–º—ñ—Ç—É —Å–ª–æ—Ç—ñ–≤ (—Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Å–ª–æ—Ç —â–µ –ù–ï –∑–∞–π–Ω—è—Ç–∏–π)
	if {buff.active.slot.%{_p}%.%{_category}%} is not set:
		set {_maxSlots} to getMaxBuffSlots({_p})
		set {_usedSlots} to getActiveBuffSlotsCount({_p})
		
		if {_usedSlots} >= {_maxSlots}:
			return false
	
	# –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —è–∫ –∞–∫—Ç–∏–≤–Ω–∏–π –¥–ª—è —Ü—ñ—î—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
	set {buff.active.slot.%{_p}%.%{_category}%} to {_buffId}
	return true

# –î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ –±–∞—Ñ –≤ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
function deactivateBuff(p: player, category: text):
	delete {buff.active.slot.%{_p}%.%{_category}%}

# –û—Ç—Ä–∏–º–∞—Ç–∏ –≤—Å—ñ –∞–∫—Ç–∏–≤–Ω—ñ –±–∞—Ñ–∏
function getActiveBuffs(p: player) :: objects:
	clear {_result::*}
	loop {buff::categories::*}:
		if {buff.active.slot.%{_p}%.%loop-value%} is set:
			add {buff.active.slot.%{_p}%.%loop-value%} to {_result::*}
	return {_result::*}
